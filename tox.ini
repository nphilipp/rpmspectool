[tox]
minversion = 3.11.0
envlist = format,lint,absolufy-imports,py3{11,12}
isolated_build = true
skip_missing_interpreters = true

[testenv]
deps = uv
allowlist_externals = pytest
skip_install = true
sitepackages = false
commands_pre =
    uv sync --active --group test
commands =
    pytest -o 'addopts=--cov-config .coveragerc --cov=rpmspectool --cov-report=term --cov-report=xml --cov-report=html' tests/

[testenv:format]
deps = ruff
commands_pre =
commands = ruff format --diff rpmspectool/ tests/

[testenv:lint]
deps = ruff
commands_pre =
commands = ruff check rpmspectool/ tests/

[testenv:absolufy-imports]
deps = absolufy-imports
allowlist_externals = find
commands_pre =
commands =
    find rpmspectool -name \*.py -exec absolufy-imports --never \{\} ;
